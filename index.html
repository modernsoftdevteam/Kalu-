<!-- üî• KALU AI POWER FIXED VERSION üî• -->
<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>KALU AI - ULTRA</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body,html{height:100%;margin:0;font-family:sans-serif;background:#0f172a;color:white;overflow:hidden}
.app{display:flex;flex-direction:column;height:100vh}
header{background:#1e293b;padding:15px;border-bottom:2px solid #3b82f6}
#chat{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:12px}
.user{align-self:flex-end;background:#2563eb;padding:10px 15px;border-radius:18px 18px 4px 18px;max-width:80%}
.ai{align-self:flex-start;background:#334155;padding:10px 15px;border-radius:18px 18px 18px 4px;max-width:80%;border:1px solid #475569}
footer{padding:10px;background:#0f172a;border-top:1px solid #334155}
.box{display:flex;gap:8px;background:#1e293b;padding:8px 15px;border-radius:30px;border:1px solid #3b82f6}
input{flex:1;background:transparent;border:none;color:white;outline:none}
button{font-size:18px}
.typing{opacity:.6;font-style:italic}
</style>
</head>
<body>

<div class="app">
<header>
<b>KALU AI ü§ñ</b>
<p id="status" class="text-xs text-blue-400">‡¶ö‡ßá‡¶ï‡¶ø‡¶Ç...</p>
</header>

<div id="chat">
<div class="ai">‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï, ‡¶ï‡¶æ‡¶≤‡ßÅ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
</div>

<footer>
<div class="box">
<button onclick="startListening()">üéôÔ∏è</button>
<input id="input" placeholder="‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®..." disabled>
<button onclick="send()">üöÄ</button>
</div>
</footer>
</div>

<script type="module">
import * as webllm from "https://esm.run/@mlc-ai/web-llm";

let engine;
let busy=false;
let messages=[
{role:"system",content:"‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡¶æ‡¶≤‡ßÅ‡•§ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡ßü ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶æ‡¶ì‡•§"}
];

const chat=document.getElementById("chat");
const input=document.getElementById("input");
const status=document.getElementById("status");

function addMsg(text,type){
const div=document.createElement("div");
div.className=type;
div.innerHTML=text;
chat.appendChild(div);
chat.scrollTo({top:chat.scrollHeight,behavior:"smooth"});
}

function speak(text){
speechSynthesis.cancel();
let u=new SpeechSynthesisUtterance(text);
u.lang="bn-BD";
speechSynthesis.speak(u);
}

async function init(){
if(!navigator.gpu){
status.innerHTML="‚ùå WebGPU ‡¶®‡ßá‡¶á ‚Üí chrome://flags ‡¶è ‡¶ó‡¶ø‡ßü‡ßá Enable ‡¶ï‡¶∞‡ßÅ‡¶®";
return;
}
try{
status.innerHTML="‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
engine=await webllm.CreateMLCEngine("Qwen2-0.5B-Instruct-q4f16_1-MLC",{
initProgressCallback:r=>{
status.innerHTML="‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°: "+Math.round(r.progress*100)+"%";
if(r.progress===1){
status.innerHTML="‚úÖ ‡¶ï‡¶æ‡¶≤‡ßÅ ‡¶∞‡ßá‡¶°‡¶ø";
input.disabled=false;
input.placeholder="‡¶π‡ßÅ‡¶ï‡ßÅ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï...";
}
}
});
}catch(e){
status.innerHTML="‚ùå ‡¶≤‡ßã‡¶° ‡¶´‡ßá‡¶á‡¶≤";
}
}

window.send=async function(){
if(busy||!engine)return;
let text=input.value.trim();
if(!text)return;
busy=true;

addMsg(text,"user");
messages.push({role:"user",content:text});
input.value="";

addMsg("‡¶ï‡¶æ‡¶≤‡ßÅ ‡¶≠‡¶æ‡¶¨‡¶õ‡ßá...","ai typing");

const reply=await engine.chat.completions.create({messages});
chat.lastChild.remove();

let aiText=reply.choices[0].message.content;
messages.push({role:"assistant",content:aiText});

addMsg("<b>‡¶ï‡¶æ‡¶≤‡ßÅ:</b> "+aiText,"ai");
speak(aiText);

busy=false;
}

input.addEventListener("keydown",e=>{
if(e.key==="Enter")send();
});

window.startListening=function(){
if(!('webkitSpeechRecognition'in window)){
alert("Speech Recognition ‡¶®‡ßá‡¶á");
return;
}
let rec=new webkitSpeechRecognition();
rec.lang="bn-BD";
rec.start();
rec.onresult=e=>{
input.value=e.results[0][0].transcript;
send();
}
}

init();
</script>

</body>
</html>
